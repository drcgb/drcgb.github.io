<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Searchable and Filterable Table</title>
    <style>
        body { font-family: Arial, sans-serif; font-size: 14px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        table, th, td { border: 1px solid black; padding: 10px; }
        th { background-color: #f2f2f2; white-space: normal; text-align: center; }
        th:nth-child(1), td:nth-child(1) { text-align: center; width: 10%; } /* Center text in Abstract ID and set narrow width */
        th:nth-child(3), td:nth-child(3) { width: auto; } /* Make Preliminary Title & Abstract as wide as possible */
        th:not(:nth-child(3)), td:not(:nth-child(3)) { width: 15%; } /* Make other columns narrow */
        .search-container, .filter-container { margin-bottom: 10px; display: flex; align-items: center; }
        #searchInput {
            width: 100%;
            padding-left: 24px;
            font-size: 14px; /* Set font size to match the rest of the text */
            background-image: url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"%3E%3Cpath stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16l-4.4 4.4a1 1 0 01-1.4 0L2 19.2a1 1 0 010-1.4L6.4 14a8 8 0 111.6 1.6zM14 10a4 4 0 10-8 0 4 4 0 008 0z" /%3E%3C/svg%3E');
            background-position: 8px center;
            background-repeat: no-repeat;
            background-size: 16px;
            -webkit-appearance: none; /* Removes default search icon on WebKit browsers */
            -moz-appearance: none; /* Removes default search icon on Firefox */
        }
        .clear-filters { margin-left: 20px; cursor: pointer; background-color: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 5px; transition: background-color 0.3s, color 0.3s; }
        .clear-filters.active { background-color: red; } /* Red when filters are active */
        .filter-notice { margin: 10px 0; font-style: italic; color: #555; }
    </style>
</head>
<body>

<div class="search-container">
    <input type="text" id="searchInput" onkeyup="filterTable()" placeholder="ðŸ” Search abstracts...">
</div>

<div class="filter-container">
    <label for="methodFilter">Filter by Main Method:</label>
    <select id="methodFilter" onchange="filterTable()"><option value="">All</option></select>
    <label for="areaFilter" style="margin-left: 20px;">Filter by Research Area:</label>
    <select id="areaFilter" onchange="filterTable()"><option value="">All</option></select>
    <button class="clear-filters" onclick="clearFilters()">No filters selected</button>
</div>

<div class="filter-notice" id="filterNotice" style="display: none;">You are currently filtering the results.</div>

<table id="abstractTable">
    <thead>
        <tr><th>Abstract<br>ID</th><th>Main<br>Method</th><th>Preliminary<br>Title & Abstract</th><th>Research<br>Area 1</th><th>Research<br>Area 2</th><th>Research<br>Area 3</th></tr>
    </thead>
    <tbody></tbody>
</table>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
<script>
    let allRows = [];

    document.addEventListener("DOMContentLoaded", function() {
        fetch("Prelim_Hons_Thesis_Titles_and_Abstracts_2024_FinalX.xlsx")
            .then(res => res.arrayBuffer())
            .then(data => {
                const sheet = XLSX.read(data, {type: "array"}).Sheets[XLSX.read(data, {type: "array"}).SheetNames[0]];
                allRows = XLSX.utils.sheet_to_json(sheet, {header: 1}).slice(1);
                populateTable(allRows); populateFilterOptions(allRows); updateClearFiltersButton();
            })
            .catch(err => console.error('Error loading XLSX data:', err));
    });

    function populateTable(rows) {
        const tbody = document.querySelector("#abstractTable tbody");
        tbody.innerHTML = ""; // Clear previous rows
        rows.forEach(row => {
            const [abstractID, mainMethod = '', methodDetail = '', preliminaryTitle = '', preliminaryAbstract = '', researchArea1 = '', researchArea2 = '', researchArea3 = ''] = row;
            tbody.innerHTML += `<tr>
                <td>${abstractID || ''}</td>
                <td>${mainMethod + (methodDetail ? ` (${methodDetail})` : '')}</td>
                <td><strong>${preliminaryTitle}</strong><br>${preliminaryAbstract}</td>
                <td>${researchArea1}</td>
                <td>${researchArea2}</td>
                <td>${researchArea3}</td>
            </tr>`;
        });
    }

    function populateFilterOptions(rows) {
        const methodFilter = document.getElementById("methodFilter");
        const areaFilter = document.getElementById("areaFilter");
        const methodCounts = {}, areaCounts = {};
        rows.forEach(row => {
            const mainMethod = row[1] || '', researchAreas = [row[5] || '', row[6] || '', row[7] || ''];
            if (mainMethod) methodCounts[mainMethod] = (methodCounts[mainMethod] || 0) + 1;
            researchAreas.forEach(area => area && (areaCounts[area] = (areaCounts[area] || 0) + 1));
        });

        methodFilter.innerHTML += Object.entries(methodCounts).sort(([a], [b]) => a.localeCompare(b))
            .map(([method, count]) => `<option value="${method}">${method} [${count} matches]</option>`).join('');
        areaFilter.innerHTML += Object.entries(areaCounts).sort(([a], [b]) => a.localeCompare(b))
            .map(([area, count]) => `<option value="${area}">${area} [${count} matches]</option>`).join('');
    }

    function filterTable() {
        const searchInput = document.getElementById("searchInput").value.toLowerCase();
        const methodFilter = document.getElementById("methodFilter").value.toLowerCase();
        const areaFilter = document.getElementById("areaFilter").value