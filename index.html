<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Searchable and Filterable Table</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css">
    <style>
        body, table, th, td, .dataTables_wrapper .dataTables_filter input, 
        .dataTables_wrapper .dataTables_length, .dataTables_wrapper .dataTables_info {
            font-family: Arial, sans-serif; font-size: 14px; line-height: 1.2;
        }
        .dataTables_wrapper .dataTables_filter {
            text-align: left;
            width: 100%;
            margin-bottom: 10px;
        }
        .dataTables_wrapper .dataTables_filter input {
            width: 100%; padding: 10px; border-radius: 4px; margin-bottom: 10px; font-size: 16px;
        }
        .dataTables_wrapper .dataTables_length {
            text-align: right;
            margin-bottom: 10px;
        }
        .dataTables_wrapper .method-filter-container {
            text-align: left;
            margin-bottom: 10px;
        }
        table, th, td {
            padding: 0px; border-collapse: collapse; border: 1px solid black;
        }
        th {
            background-color: #f2f2f2; text-align: left; vertical-align: middle;
        }
        table.dataTable tbody tr:hover {
            background-color: #e0f7fa;
        }
    </style>
</head>
<body>

<!-- Filter Method -->
<div class="dataTables_wrapper">
    <div class="dataTables_filter" id="abstractTable_filter"></div>
    <div class="method-filter-container">
        <label for="methodFilter">Filter(Method):</label>
        <select id="methodFilter"><option value="">All</option></select>
    </div>
</div>

<!-- Table -->
<table id="abstractTable" class="display">
    <thead>
        <tr><th>Preliminary Title and Abstract</th></tr>
    </thead>
    <tbody></tbody>
</table>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
<script>
    let allRows = [];
    let dataTable;

    document.addEventListener("DOMContentLoaded", async () => {
        try {
            const response = await fetch("Prelim_Hons_Thesis_Titles_and_Abstracts_2024_FinalX.xlsx");
            const data = await response.arrayBuffer();
            const workbook = XLSX.read(data, { type: "array" });
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            allRows = XLSX.utils.sheet_to_json(sheet, { header: 1 }).slice(1);

            populateTable(allRows);
            populateMethodFilter(allRows);
            initializeDataTable();
        } catch (err) {
            console.error('Error loading XLSX data:', err);
        }
    });

    function initializeDataTable() {
        dataTable = $('#abstractTable').DataTable({
            paging: true,
            searching: true,
            info: true,
            autoWidth: false,
            ordering: false,
            lengthMenu: [[15, 30, 60, -1], [15, 30, 60, `${allRows.length} (All)`]],
            language: {
                lengthMenu: 'Show up to _MENU_ records per page',
                search: '',
                searchPlaceholder: 'üîçSearch abstracts...'
            },
            dom: '<"top"f>rt<"bottom"l><"clear">',
        });

        // Attach filter method change event
        $('#methodFilter').on('change', function() {
            const selectedMethod = this.value.toLowerCase();
            dataTable.column(0).search(selectedMethod).draw();
        });
    }

    function populateTable(rows) {
        const tbody = document.querySelector("#abstractTable tbody");
        tbody.innerHTML = rows.map(row => {
            const [abstractID, mainMethod = '', methodDetail = '', preliminaryTitle = '', preliminaryAbstract = '', ...researchAreas] = row;
            const titleWithID = `<strong>ID: </strong>${abstractID}&nbsp&nbsp <strong>|</strong>&nbsp&nbsp <strong class="method-section">Method:</strong> ${mainMethod}${methodDetail ? ` (${methodDetail})` : ''} &nbsp <br><br> <strong class="abstract-title">${preliminaryTitle}</strong>`;
            const methodAndAreas = `<strong class="areas-section">Areas:</strong> ${researchAreas.filter(Boolean).join('; ')}`;
            return `<tr><td><br>${titleWithID}<br>${preliminaryAbstract}<br><br>${methodAndAreas}<br><br></td></tr>`;
        }).join('');
    }

    function populateMethodFilter(rows) {
       ‚Äã‚¨§